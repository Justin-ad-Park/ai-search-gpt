# 11. 리팩터링 TODO

목표: 현재 코드 기준으로 네이밍/패키지/클래스 구조의 혼동 포인트를 줄이고 유지보수성을 높인다.  
원칙: 기능 변경 없이(동작 동일), 점진적으로 적용한다.

## 1) `SearchRequest` 타입명 충돌 해소 (우선순위: 높음)

- 현상
  - 앱 모델 `com.example.aisearch.model.search.ProductSearchRequest`
  - ES 클라이언트 `co.elastic.clients.elasticsearch.core.SearchRequest`
  - 동일 이름으로 코드 리뷰/유지보수 시 혼동 가능.
- TODO
  - [V] 앱 모델명 변경안 검토: `ProductSearchRequest`
  - [V] 영향 범위 산정(Controller/Service/Builder/Test)
  - [V] 변경 시 import/FQCN 정리
- 판단 기준
  - 코드 가독성 개선 효과가 크고, 런타임 리스크는 낮음.

## 2) `EmbeddingService` 패키지 정렬 (우선순위: 높음)

- 현상
  - 인터페이스: `service.embedding.model.EmbeddingService`
  - 구현체: `service.embedding.DjlEmbeddingService`
  - 계약 인터페이스가 `model` 패키지에 있어 역할 경계가 어색함.
- TODO
  - [V] 인터페이스를 `service.embedding`으로 이동 검토
  - [V] `model` 패키지는 값 객체(`EmbeddingModelSource` 등) 중심으로 정리
  - [V] 패키지 변경에 따른 import 정리
- 판단 기준
  - SRP/패키지 응집도 개선, 기능 영향 없음.

## 3) 메서드명 의미 정합성 개선 (우선순위: 중간)

- 현상
  - `KnnSearchStrategy.hybridSearch(...)`는 실제로 하이브리드 검색(lexical+vector+boost) 수행.
- TODO
  - [V] `vectorScoreSearch` -> `hybridSearch` 리네임 적용
  - [V] 관련 주석/문서 명칭 동기화
- 판단 기준
  - 동작 영향 없이 의도 전달력 향상.

## 6) 선택 검토: 검색 서비스 네이밍 (우선순위: 낮음)

- 현상
  - 현재 서비스는 query 없는 filter-only 경로도 처리하므로 이름이 다소 좁게 느껴질 수 있음.
- TODO
  - [V] `VectorSearchService` -> `ProductSearchService` 변경 적용
  - [V] 관련 주석/문서 명칭 동기화
- 판단 기준
  - 팀 내 용어 일관성 우선. 변경 이점이 작으면 유지.

## 적용 순서 제안

1. `SearchRequest` 타입명 충돌 해소
2. `EmbeddingService` 패키지 정렬
3. 메서드명 의미 정합성 리네임
4. 빈 패키지 정리
5. 소스 내 문서 위치 정리
6. `ProductSearchService` 명칭 반영

## 검증 기준

- [ ] 기존 테스트 전부 통과
- [ ] API 스펙/요청 파라미터/정렬 결과 동작 동일
- [ ] 문서(`docs/11`, `docs/12`) 용어와 코드 용어 일치
