# 08. 사용자 정의 사전

## 목적
- Nori 형태소 분석 시 도메인 용어를 원하는 형태로 토큰화한다.
- 예: `얇은피`, `얄피`를 한 토큰으로 유지해 검색 품질을 안정화한다.

## 파일 위치
- `src/main/resources/es/dictionary/user_dict_ko.txt`

예시:
```text
얇은피
얄피
```

## 적용 포인트
1. `nori_tokenizer`에 사용자 사전 연결
- `user_dictionary` 또는 `user_dictionary_rules` 설정 필요

2. analyzer 구성
- 색인용 analyzer와 검색용 analyzer를 분리해 관리 권장
- 사용자 사전은 토크나이저 레벨에서 적용됨

3. 필드 매핑
- `product_name`, `description`에 해당 analyzer 적용

## 반영 방식
- ECK 기준:
1. ConfigMap/Secret 마운트
2. 커스텀 이미지 내장

현재 프로젝트는 커스텀 이미지 운영 경로를 사용 중이므로, 사용자 사전 파일을 이미지 또는 마운트 경로로 노출해야 한다.

## 재색인 필요성
- 사용자 사전은 토크나이저 규칙을 바꾸므로 기존 색인 토큰과 불일치가 발생한다.
- 따라서 변경 시 권장 절차:
1. 신규 인덱스 생성 (`v2`)
2. 재색인
3. 검증
4. alias 전환
5. 구 인덱스 정리

## 테스트 권장
- `_analyze` API로 토큰화 결과 확인
- 통합 테스트에서 `얇은피`, `얄피` 검색 결과 검증
- 동의어 문서(07)와 함께 검증해 실제 검색 결과를 점검

## 주의사항
- 사용자 사전 변경은 `reload_search_analyzers`만으로 충분하지 않다.
- 운영 중 무중단 반영이 필요하면 인덱스 버저닝 + alias 전환 전략을 사용한다.
