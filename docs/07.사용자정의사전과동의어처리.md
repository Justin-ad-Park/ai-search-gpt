사용자 정의 사전과 동의어 사전을 만들고, 검색 엔진에 동의어 처리 기능을 넣으려고 해.
예를 들어 만두, 얇은피, 얄피 이 3 단어를 동의어로 등록해서 얇은피를 검색했을 때 "설에 끓여 먹는 생만두"라는 상품이 검색되도록
어떤 과정으로 작업할지 작업 방식을 정리해줘


• 좋아요. 작업은 아래 순서가 안전합니다.

1. 사전 파일 정의

- user_dict_ko.txt: 사용자 정의 형태소(예: 얇은피, 얄피)
- synonyms_ko.txt: 동의어 규칙
    - 예: 만두, 얇은피, 얄피
- 위치: src/main/resources/es/dict/

2. 인덱스 분석기 확장

- index-mapping.json의 analysis에 추가
    - tokenizer: nori_tokenizer + user_dictionary 연결
    - filter: synonym_graph(검색용), POS 필터
    - analyzer 2개 권장:
        - ko_index_analyzer (색인용, synonym 제외 가능)
        - ko_search_analyzer (검색용, synonym_graph 포함)

3. 필드 매핑 전략

- product_name, description에
    - analyzer: ko_index_analyzer
    - search_analyzer: ko_search_analyzer
- 이렇게 하면 저장은 안정적으로, 검색 시 동의어 확장이 적용됨.

4. 검색 쿼리 반영

- 현재 multi_match가 analyzer를 타므로 search_analyzer 자동 적용됨.
- 필요 시 쿼리에서 analyzer를 명시해 고정 가능.

5. 클러스터 반영 방식

- 사전 파일을 ES 노드가 읽을 수 있어야 함.
- ECK에서는 보통
    - ConfigMap/Secret 마운트 또는
    - 커스텀 이미지에 사전 파일 내장
- 지금 커스텀 이미지 방식을 쓰고 있으니 내장 방식이 가장 단순함.

6. 재색인 절차

- 분석기/사전 변경은 기존 인덱스에 즉시 반영 안 됨.
- 필수: 인덱스 재생성 + 재색인.

7. 검증 테스트 추가

- 통합 테스트 케이스:
    - query=얇은피 -> 결과에 “생만두” 포함
    - query=얄피 -> 동일
    - query=만두 -> 동일
- _analyze API로 토큰화/동의어 확장도 확인.

8. 운영 고려

- 동의어 파일 변경 주기 높으면
    - 사전 버전 관리(dict v1, v2) + 재색인 자동화 스크립트 필요
- 확장 규칙 충돌 방지:
    - 단방향(=>) vs 양방향(,) 규칙 구분해서 사용.

원하면 제가 바로 다음 턴에서

- 사전 파일 추가
- 매핑/분석기 수정
- 커스텀 이미지에 사전 포함
- 테스트 케이스까지 실제 코드로 반영해드릴게요.
