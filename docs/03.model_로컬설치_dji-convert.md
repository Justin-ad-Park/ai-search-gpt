## 6. 로컬 모델 경로(optModelPath)로 로딩하는 방법
아래는 `multilingual-e5-small-ko-v2`를 **로컬에 내려받아** DJL이 `optModelPath`로 로딩하도록 구성하는 흐름입니다.

### 6-1. 로컬로 모델 내려받기 (djl-convert)
DJL에서 제공하는 `djl-convert`를 이용하면 Hugging Face 모델을 로컬 폴더로 변환할 수 있습니다.

#### 1) `djl-converter` 설치 (권장: 공식 휠)
공식 배포 휠을 `pip`로 설치합니다.
```bash

python3 -m pip --version

brew install python

python3 -m pip --version

pip install https://publish.djl.ai/djl_converter/djl_converter-0.30.0-py3-none-any.whl
```

#### 2) 소스에서 설치 (대안)
로컬 클론 후 설치:
```bash
#개인별 설치 생성 및 이동
cd ~/idea/  
mkdir djl
cd djl
git clone https://github.com/deepjavalibrary/djl.git
cd djl/extensions/tokenizers/src/main/python
python3 -m pip install -e .

#안되면 pipx 설치 후 실행
brew install pipx
pipx install -e .


DJL 저장소를 직접 받아 설치할 수도 있습니다.
```bash
pip install "git+https://github.com/deepjavalibrary/djl.git#subdirectory=extensions/tokenizers/src/main/python"
```

```

예시:
```bash
djl-convert -m dragonkue/multilingual-e5-small-ko-v2


안되면... 
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# 컴파일 에러 발생 시
pipx inject djl_converter onnx


# 그래도 또 안되면...
• python3.11이 PATH에 없습니다. 먼저 3.11을 설치해야 합니다.
  macOS(Homebrew) 기준
  brew install python@3.11

# 그 후에 아래와 같이 다시 인스톨
 PY311="$(which python3.11)"
  if [ -z "$PY311" ]; then
    echo "python3.11 not found in PATH"
    exit 1
  fi
  pipx install --python "$PY311" https://publish.djl.ai/djl_converter/djl_converter-0.30.0-py3-none-any.whl


# 모델 컨버트 재시도
#개인별 설치 생성 및 이동
cd ~/idea/  
mkdir djl
cd djl
git clone https://github.com/deepjavalibrary/djl.git
cd djl/extensions/tokenizers/src/main/python

echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# 기존 컴파일 실패한 모델 경로를 강제 삭제
rm -rf model

djl-convert -m dragonkue/multilingual-e5-small-ko-v2

```

생성된 폴더 예시:
```
model/dragonkue/multilingual-e5-small-ko-v2/
```

생성된 폴더를 main/java/resources/model/multilingual-e5-small-ko-v2 로 복사
이 폴더가 **로컬 모델 경로**입니다.



### 6-2. 애플리케이션에서 optModelPath로 로딩
현재 프로젝트는 `optModelUrls(...)`를 사용합니다. 로컬 경로를 쓰려면 `optModelPath(...)`로 변경합니다.

예시:
```java
Criteria<String, float[]> criteria = Criteria.builder()
    .setTypes(String.class, float[].class)
    .optApplication(Application.NLP.TEXT_EMBEDDING)
    .optModelPath(Paths.get("model/dmultilingual-e5-small-ko-v2/"))
    .optProgress(new ProgressBar())
    .build();
```

### 6-3. 운영 체크포인트
- 모델 변경 시 **벡터 차원이 달라질 수 있어 재색인 필요**
- 운영 환경에도 **동일한 로컬 모델 폴더를 배포**해야 함
